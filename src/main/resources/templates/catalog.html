<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <title>Каталог</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
          crossorigin="anonymous">
    <!-- из примера Фисунова -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">

    <!-- full path: src\main\resources\static\css -->
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<div class="container">

<!--    <header th:replace="fragments/header.html :: header (activePage=${activePage})"/>-->
    <!-- в контроллере не определен атрибут activePage -->
    <header th:replace="fragments/header.html
    :: header(activePage=${activePage}, categories=${categories})"></header>
<!--    <header th:replace="fragments/header.html ::-->
<!--        header(categories=${categories})">-->
<!--    </header>-->

    <!-- Карусель с индикаторами и подписями -->
    <!-- https://bootstrap-4.ru/docs/4.3.1/components/carousel/ -->
    <!-- //TODO Временно отключен -->
    <div class="bd-example" style="display: none">
        <div id="carouselExampleCaptions" class="carousel slide" data-ride="carousel">
            <ol class="carousel-indicators">
                <li data-target="#carouselExampleCaptions" data-slide-to="0" class="active"></li>
                <li data-target="#carouselExampleCaptions" data-slide-to="1"></li>
                <li data-target="#carouselExampleCaptions" data-slide-to="2"></li>
            </ol>
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img src="..." class="d-block w-100" alt="...">
                    <div class="carousel-caption d-none d-md-block">
                        <h5 class="color-black">First slide label</h5>
                        <p class="color-black">Nulla vitae elit libero, a pharetra augue mollis interdum.</p>
<!--                        <h5 class="color-black" style="color: teal">First slide label</h5>-->
<!--                        <p class="color-black" style="color: teal">Nulla vitae elit libero, a pharetra augue mollis interdum.</p>-->
                    </div>
                </div>
                <div class="carousel-item">
                    <img src="..." class="d-block w-100" alt="...">
                    <div class="carousel-caption d-none d-md-block">
                        <h5>Second slide label</h5>
                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
                    </div>
                </div>
                <div class="carousel-item">
                    <img src="..." class="d-block w-100" alt="...">
                    <div class="carousel-caption d-none d-md-block">
                        <h5>Third slide label</h5>
                        <p>Praesent commodo cursus magna, vel scelerisque nisl consectetur.</p>
                    </div>
                </div>
            </div>
            <a class="carousel-control-prev" href="#carouselExampleCaptions" role="button" data-slide="prev">
<!--            <a class="carousel-control-prev bg-dark" href="#carouselExampleCaptions" role="button" data-slide="prev">-->
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleCaptions" role="button" data-slide="next">
<!--            <a class="carousel-control-next bg-dark" href="#carouselExampleCaptions" role="button" data-slide="next">-->
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>
    </div>

    <!-- блок фильтрации -->
    <form class="filter-form" th:action="@{/catalog/all}" method="GET">
        <div class="input-group">
<!--            <input th:hidden="true" th:value="${param.category}" name="category" type="number"/>-->

            <label>
                <select name="category"
                        class="btn btn-info dropdown-toggle catalog__filter__select">
                    <option th:text="'Все категории'"
                            th:selected="${param.category == null}" th:value="null"></option>

                    <option th:each="category : ${categories}"
                            th:text="${category.title}"
                            th:selected="${#strings.equals(param.category, category.id)}" th:value="${category.id}"></option>
                </select>
            </label>
            <!-- http://localhost:8080/shop/catalog/all?minPrice=11&max_price=19 -->
            <!-- параметр в запросе "minPrice" - это name в input -->
            <!-- чтобы принять сюда значение параметра, должны совпадать названия в th:value="${param.xxx} и в name="xxx" -->
            <input class="form-control" th:value="${param.minPrice}" name="minPrice" type="number"
                   placeholder="Минимальная цена"/>
            <input class="form-control" th:value="${param.maxPrice}" name="maxPrice" type="number"
                   placeholder="Максимальная цена"/>
            <input class="form-control" th:value="${param.limit}" name="limit" type="number"
                   placeholder="Товаров на странице"/>
            <!-- выпадающий список направления сортировки -->
            <label>
                <select name="direction"
                        class="btn btn-info dropdown-toggle catalog__filter__select">
                    <option th:text="'По возрастанию цены'"
                            th:selected="${#strings.equals(param.direction, 'ASC')}" th:value="ASC"></option>
                    <option th:text="'По убыванию цены'"
                            th:selected="${#strings.equals(param.direction, 'DESC')}" th:value="DESC"></option>
                </select>
            </label>
        </div>

        <div class="catalog__filter__btn-group">
            <button type="submit" class="btn btn-info catalog__filter__btn">Применить</button>
            <a class="btn btn-secondary" th:href="@{'/catalog/all'}">Сбросить</a>
        </div>
    </form>

    <!-- product cards block-->
    <div class="card-deck">
        <div class="card" th:each="p : ${page}">
            <picture class="card-img-top">
                <a th:href="@{/catalog/{prod_id}/details(prod_id = ${p.id})}">
                            <img src="..." alt="Image of product">
                        </a>
            </picture>

            <div class="card-body">
                <a th:href="@{/catalog/{prod_id}/details(prod_id = ${p.id})}">
                    <h5 class="card-title" th:text="${p.title}">Title of product</h5>
                </a>
            </div>

            <div class="card-footer">
                <small class="price" th:text="${p.price} + ' руб.'">Price of product</small>
            </div>
        </div>
    </div>

    <!-- номерация страниц -->
    <div class="catalog__pagination_div">
        <nav aria-label="Pagination">
            <ul class="pagination">
                <li class="page-item">
                    <a class="page-link"
                       th:href="@{'/catalog/all?page='
                       + ${page.previousOrFirstPageable().getPageNumber() + 1}
                       + ${filterDef}}">Previous</a>
                </li>

                <li class="page-item"
                    th:classappend="${page.getNumber() + 1 == i ? 'active' : ''}"
                    th:each="i : ${#numbers.sequence(1, page.getTotalPages())}">
                    <a class="page-link" th:text="${i}"
                       th:href="@{'/catalog/all?page='
                       + ${i} + ${filterDef}}"></a></li>

                <li class="page-item">
                    <a class="page-link"
                       th:href="@{'/catalog/all?page='
                       + ${page.nextOrLastPageable().getPageNumber() + 1}
                       + ${filterDef}}">Next</a>
                </li>
            </ul>
        </nav>
    </div>

    <footer th:replace="fragments/footer.html"></footer>

</div>

</html>